<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - AgroMarket</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style1.css">
    <style>
     /* Global Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

.listings-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px; /* Space between the listing cards */
  justify-content: flex-start;
}

.listing-card {
  display: flex;
  flex-direction: row;
  align-items: center;
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  padding: 15px;
  border-radius: 8px;
  width: -webkit-fill-available;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.listing-card img {
  width: 60px; /* Small image size */
  height: 60px;
  object-fit: cover;
  border-radius: 50%;
  margin-right: 15px;
}

.listing-info {
  flex-grow: 1; /* This allows the title, price, and buttons to take up remaining space */
}

.listing-info h3 {
  font-size: 18px;
  margin: 0;
  color: #333;
}

.listing-info p {
  font-size: 16px;
  margin: 5px 0;
  color: #777;
}

.buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.modify-btn, .delete-btn {
  padding: 6px 12px;
  font-size: 14px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.modify-btn {
  background-color: #4CAF50;
  color: white;
}

.modify-btn:hover {
  background-color: #45a049;
}

.delete-btn {
  background-color: #f44336;
  color: white;
}

.delete-btn:hover {
  background-color: #e53935;
}


body {
  background-color: #f4f6f9;
  display: flex;
  color: #333;
  height: 100vh;
  flex-direction: column;
}

.container {
  display: flex;
  width: 100%;
  height: 100%;
}

/* Sidebar Styles */
.sidebar {
  width: 250px;
  background-color: #2c3e50;
  padding: 20px;
  color: white;
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
}

.sidebar a {
  display: block;
  color: white;
  padding: 15px;
  text-decoration: none;
  font-size: 16px;
  margin-bottom: 10px;
  border-radius: 5px;
  transition: background-color 0.3s;
}

.sidebar a:hover {
  background-color: #34495e;
}

.sidebar .logo {
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 30px;
}

.sidebar .menu {
  margin-top: 20px;
}

/* Main Content Styles */
.main-content {
  margin-left: 250px;
  padding: 20px;
  width: 100%;
  height: 100%;
  overflow-y: auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background-color: #ffffff;
  border-bottom: 1px solid #ddd;
}

.header h1 {
  font-size: 24px;
  color: #333;
}

.header .search-bar {
  padding: 8px;
  width: 300px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.card {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
  padding: 20px;
}

.card h2 {
  font-size: 18px;
  margin-bottom: 10px;
}

.card p {
  font-size: 14px;
  color: #777;
}

.card .card-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card .card-content .stat {
  font-size: 24px;
  font-weight: bold;
}

.card .card-content .stat-value {
  color: #2ecc71;
}

.card .card-content .stat-value.alert {
  color: #e74c3c;
}

/* Footer Styles */
.footer {
  text-align: center;
  padding: 20px;
  background-color: #34495e;
  color: white;
  position: absolute;
  bottom: 0;
  width: 100%;
}

/* Responsive Styles */
@media (max-width: 768px) {
  .container {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    position: relative;
    height: auto;
  }

  .main-content {
    margin-left: 0;
  }

  .header h1 {
    font-size: 20px;
  }

  .header .search-bar {
    width: 200px;
  }
}

section.dashboard {
  background-color: #ffffff;
  float: left;
  width: 30%;
  border-radius: 8px;
  padding: 20px;
  height: inherit;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.dashboard h1 {
  text-align: center;
  font-size: 28px;
  color: #2c3e50;
  margin-bottom: 20px;
}

/* Container for user information */
#userInfo {
    padding: 20px;              /* Add some padding around the content */
    border-radius: 8px;         /* Rounded corners for a modern look */
    max-width: 600px;           /* Limit the width to avoid text stretching too much */
    margin: 0 auto;             /* Center it horizontally */
    text-align: left;           /* Left-align the text */
    font-family: 'Arial', sans-serif; /* Modern, clean font */
}

/* Style for each paragraph in the user information */
#userInfo p {
    font-size: 16px;  /* Set a comfortable font size */
    color: #333;      /* Dark gray text for readability */
    margin: 10px 0;   /* Add some space between paragraphs */
    line-height: 1.6;  /* Improve readability by increasing line height */
}

/* Styling for the user name */
#userName {
    font-weight: bold;     /* Make the name bold */
    font-size: 18px;       /* Slightly larger font size for emphasis */
    color: #2d87f0;        /* A blue color to make the name stand out */
}

#updateSection {
  display: none;
  margin-top: 20px;
  background-color: #ecf0f1;
  padding: 20px;
  border-radius: 8px;
}

#updateSection h3 {
  font-size: 20px;
  color: #34495e;
  margin-bottom: 15px;
}

#updateForm {
  display: flex;
  flex-direction: column;
}

#updateForm label {
  font-size: 16px;
  margin-bottom: 8px;
}

#updateForm input[type="text"] {
  padding: 10px;
  font-size: 16px;
  border: 1px solid #bdc3c7;
  border-radius: 4px;
  margin-bottom: 15px;
  outline: none;
}

#updateForm button {
  padding: 10px 20px;
  font-size: 16px;
  background-color: #2ecc71;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#updateForm button:hover {
  background-color: #27ae60;
}

#editButton {
  padding: 10px 20px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#editButton:hover {
  background-color: #2980b9;
}

.listing-info button {
    margin: 2px;
    float: inline-end;
    padding: 8px;
    border: none;
    background-color: #4CAF50; /* Green background */
    color: white;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
}

.listing-info button:hover {
    background-color: #45a049;
}

.listing-info button:nth-child(2) {
    background-color: #ff9800; /* Orange for 'Modifier' */
}

.listing-info button:nth-child(3) {
    background-color: #f44336; /* Red for 'Supprimer' */
}

.listing-info button:nth-child(2):hover {
    background-color: #e68900;
}

.listing-info button:nth-child(3):hover {
    background-color: #e53935;
}

.profile-picture-container {
    text-align: center; /* Center the image */
    margin-bottom: 10px; /* Add some space below the image */
}

.profile-picture {
    width: 50%; 
    border-radius: 50%; /* Make the image circular */
    object-fit: cover; /* Ensure the image doesn't stretch, it crops to fit the circle */
    border: 2px solid #ddd; /* Optional: Add a border around the image */
}



    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo"><a href="index.html">AgroMarket</a></div>
        <div class="nav-links" id="navLinks">
            <a href="index.html" >Home</a>
            <a href="listings.html">Listings</a>
            <a href="Dashboard.html" id="Dashboard" class="active">Dashboard</a>
            <a href="logout.html" id="logoutBtn">Logout</a>
        </div>
    </nav>

    <main style="width: 100%;     display: flex;">
        <section class="dashboard">
            <h1>User Dashboard</h1>
            <div id="userInfo">
                <!-- User info will be displayed here -->
            </div>
                <!-- Message Box Button -->
          <button id="toggleMessagesButton" style="margin: 5px 0px; padding: 10px 7px;">Boîte des Messages</button>

            <div id="updateSection" style="display:none;">
                <h3>Update Your Name</h3>
                <form id="updateForm">
                    <label for="newName">New Name:</label>
                    <input type="text" id="newName" name="newName">
                    <button type="submit">Save Changes</button>
                </form>
            </div>
            <button id="editButton">Edit Name</button>
        </section>
          <!-- Message Box Container -->
          <div class="listings-grid" id="messageBox" style="display: none;    min-height: 496px;width: -webkit-fill-available;">
            <h2>Boîte des Messages</h2>
            <div id="messagesContent">
                  <!-- Message 1 (already viewed, green border) -->
                <div class="message viewed">
                    <p><strong>Said B</strong> Can we negotiate the land? I like it and want to contact you to see it.</p>
                </div>

                <!-- Message 2 (already viewed, green border) -->
                <div class="message viewed">
                    <p><strong>Mohamed :</strong> Is this land available for sale? I am interested in buying it.</p>
                </div>

                <!-- Message 3 (already viewed, green border) -->
                <div class="message viewed">
                    <p><strong>Karim:</strong> I have seen the property, and I would like to make an offer.</p>
                </div>

                <!-- Message 4 (not viewed, red border) -->
                <div class="message not-viewed">
                    <p><strong>Farid:</strong> Can you provide more details about the land location?</p>
                </div>

                <!-- Message 5 (not viewed, red border) -->
                <div class="message not-viewed">
                    <p><strong>Farid:</strong> I'm interested in the price range, could you clarify it for me?</p>
                </div>
            </div>
        </div>
        <div class="cntnt" id="productContent">
          <h1 style="text-align: center;">Product Listings</h1>
          <div id="listingsGrid" class="listings-grid">
            
              <!-- Product cards will be inserted here -->
           </div>
          </div>
    </main>
     <!-- Edit Product Modal -->
    <div id="editProductModal" style="display: none;">
      <div class="modal-content">
          <h2>Edit Product</h2>
          <form id="editProductForm">
              <label for="editProductName">Product Name:</label>
              <input type="text" id="editProductName" name="editProductName" required>
              <label for="editProductPrice">Price:</label>
              <input type="number" id="editProductPrice" name="editProductPrice" required>
              <label for="editProductLocation">Location:</label>
              <input type="text" id="editProductLocation" name="editProductLocation" required>
              <label for="editProductImage">Image URL:</label>
              <input type="text" id="editProductImage" name="editProductImage" required>
              <button type="submit">Save Changes</button>
              <button type="button" id="closeEditModal">Cancel</button>
          </form>
      </div>
    </div>
    <footer>
        <p>&copy; 2024 AgroMarket. All rights reserved.</p>
    </footer>
    <script>
      // Select the button and containers
const toggleMessagesButton = document.getElementById('toggleMessagesButton');
const messageBox = document.getElementById('messageBox');
const productContent = document.getElementById('productContent');

// Function to toggle visibility
function toggleView(showMessages) {
    if (showMessages) {
        // Show the message box and hide the product content
        messageBox.style.display = 'block';
        productContent.style.display = 'none';
        toggleMessagesButton.textContent = 'Retour au contenu principal';
        // Save the state to localStorage
        localStorage.setItem('viewState', 'messages');
    } else {
        // Show the product content and hide the message box
        messageBox.style.display = 'none';
        productContent.style.display = 'block';
        toggleMessagesButton.textContent = 'Boîte des Messages';
        // Save the state to localStorage
        localStorage.setItem('viewState', 'products');
    }
}

// Event listener for the button
toggleMessagesButton.addEventListener('click', () => {
    // Toggle the current state
    const isMessagesVisible = messageBox.style.display === 'none';
    toggleView(isMessagesVisible);
});

// Load the initial state from localStorage
document.addEventListener('DOMContentLoaded', () => {
    const savedState = localStorage.getItem('viewState');
    if (savedState === 'messages') {
        toggleView(true); // Show messages
    } else {
        toggleView(false); // Show products
    }
});


    </script>
    <script>
        // Fetch user profile data from server
        function fetchUserProfile() {
            fetch('http://localhost:5000/profile', {
                method: 'GET',
                credentials: 'include' // Ensure the cookie is sent with the request
            })
            .then(response => response.json())
            .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                document.getElementById('userInfo').innerHTML = `
                    <div class="profile-picture-container">
                        <img src="https://l.top4top.io/p_3286254j01.jpg" alt="Profile Picture" class="profile-picture">
                    </div>
                    <p>Name: <span id="userName">${data.name}</span></p>
                    <p>Email: ${data.email}</p>
                    <p>Date of Birth: ${new Date(data.dob).toLocaleDateString('en-GB')}</p>
                `;
            }
        })

            .catch(error => {
                console.error('Error fetching user profile:', error);
            });
        }

        // Handle edit button click
        document.getElementById('editButton').addEventListener('click', function() {
            document.getElementById('updateSection').style.display = 'block';
        });
        // Handle form submission to update name
        document.getElementById('updateForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const newName = document.getElementById('newName').value;

            if (!newName) {
                alert('Please enter a new name.');
                return;
            }

            fetch('http://localhost:5000/update-name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',  // Ensure the cookie is sent with the request
                body: JSON.stringify({ newName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    // Update the name on the page
                    document.getElementById('userName').textContent = newName;
                    alert('Name updated successfully!');
                }
            })
            .catch(error => {
                console.error('Error updating name:', error);
            });
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            fetchUserProfile();
        });
    </script>

<script>
  // Function to fetch and display products
  async function fetchProducts() {
      try {
          const response = await fetch('http://localhost:5000/api/products', {
              method: 'GET',
              credentials: 'include' // Include cookies to authenticate the request
          });

          if (response.ok) {
              const products = await response.json();
              displayProducts(products);
          } else {
              console.error("Failed to fetch products");
          }
      } catch (error) {
          console.error("Error:", error);
      }
  }
  // Function to display products
function displayProducts(products) {
    const productListContainer = document.getElementById('listingsGrid');
    productListContainer.innerHTML = ''; // Clear any existing content

    // Iterate over each product and create a listing card
    products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.classList.add('listing-card');

        // Add product image
        const image = document.createElement('img');
        image.src = product.image;
        image.alt = product.title;
        productCard.appendChild(image);

        // Add listing info container
        const listingInfo = document.createElement('div');
        listingInfo.classList.add('listing-info');

        // Add product title
        const title = document.createElement('h3');
        title.textContent = product.title;
        listingInfo.appendChild(title);

        // Add product price
        const price = document.createElement('p');
        price.textContent = `Price: $${product.price}`;
        listingInfo.appendChild(price);

        // Add product location
        const location = document.createElement('p');
        location.textContent = `Location: ${product.location}`;
        listingInfo.appendChild(location);

        // Add View Details button
        const button = document.createElement('button');
        button.textContent = 'View Details';
        button.onclick = function() {
            viewListing(product.id); // Assuming each product has a unique ID
        };
        listingInfo.appendChild(button);

        // Add Edit button (Modifier)
        const editButton = document.createElement('button');
        editButton.textContent = 'Modifier'; // Change this text as needed
        editButton.onclick = function() {
            editProduct(product.id); // Function to handle product editing
        };
        listingInfo.appendChild(editButton);

        // Add Delete button (Supprimer)
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Supprimer'; // Change this text as needed
        deleteButton.onclick = function() {
            deleteProduct(product.id); // Function to handle product deletion
        };
        listingInfo.appendChild(deleteButton);

        // Add Promotion Lands Ads button
        const promoButton = document.createElement('button');
        promoButton.textContent = 'Promotion Lands Ads';
        promoButton.style.backgroundColor = 'red'; // Set button color to red
        promoButton.style.color = 'white'; // Set text color to white
        promoButton.onclick = function() {
            promoteLandAd(product.id); // Function to handle land ad promotion
        };
        listingInfo.appendChild(promoButton);

        // Add Mark as Sold button
        const soldButton = document.createElement('button');
        soldButton.textContent = 'Mark comme vendre';
        soldButton.style.backgroundColor = 'green'; // Set button color to green
        soldButton.style.color = 'white'; // Set text color to white
        soldButton.onclick = function() {
            markAsSold(product.id); // Function to mark product as sold
        };
        listingInfo.appendChild(soldButton);

        // Append the listing info to the product card
        productCard.appendChild(listingInfo);

        // Append the card to the container
        productListContainer.appendChild(productCard);
    });
}


  // Placeholder function to handle "View Details"
  function viewListing(productId) {
      console.log('Viewing details for product ID:', productId);
      // You can redirect to another page or show a modal with more details
  }

  // Call fetchProducts function when the page loads
  window.onload = fetchProducts;
</script>
<script>
  // Wait until the DOM is fully loaded before adding the event listener
  document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('logoutBtn').addEventListener('click', function (event) {
          event.preventDefault();
          fetch('http://localhost:5000/logout', {
              method: 'POST',
              credentials: 'include' // Include credentials for logout (important if using sessions or cookies)
          })
          .then(response => {
              if (response.ok) {
                  return response.json();
              } else {
                  throw new Error('Logout failed');
              }
          })
          .then(data => {
              console.log('Logout successful:', data);
              // After successful logout, redirect to the home or login page
              location.href = 'index.html';  // Replace 'index.html' with the page you want to redirect to
          })
          .catch(error => {
              console.error('Logout failed:', error);
          });
      });
  });
</script>
</body>
</html>
